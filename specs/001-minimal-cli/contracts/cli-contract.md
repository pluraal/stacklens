# CLI Contract: `stacklens`

**Feature Branch**: `001-minimal-cli`  
**Framework**: Commander v14  
**Entry Point**: `dist/cli/main.js` (registered as `stacklens` binary)

---

## 1. Top-Level Program

```
stacklens [command] [options]
```

| Aspect | Value |
|---|---|
| Binary name | `stacklens` |
| Description | Semantic technology stack projection toolkit |
| Commander options | `--version`, `--help` |
| No-args behaviour | Prints top-level help; exits `0` |
| Unknown command | Prints error + hint to use `--help`; exits `1` |

---

## 2. `stacklens status`

### Synopsis

```
stacklens status [options]
```

### Description

Validates the Stackfile (`.stack`) in the current working directory and reports files not matched by any technology's detection rules.

### Options

| Flag | Description | Default |
|---|---|---|
| `--help` | Print status-command help and exit 0 | — |

> **Note**: No `--path` or `--config` option in v0. The Stackfile is always located at `<cwd>/.stack`.

### Arguments

None.

### Behaviour

| Condition | stdout | stderr | Exit Code |
|---|---|---|---|
| Valid Stackfile, all files covered | `✓ Stackfile valid. All files are covered.` | — | `0` |
| Valid Stackfile, uncovered files exist | One relative path per line | `N uncovered file(s) found.` | `1` |
| Stackfile not found | — | `Stackfile not found at: <path>` | `1` |
| Stackfile I/O error | — | `Failed to read Stackfile at: <path>` | `1` |
| Stackfile YAML syntax error | — | `Invalid YAML: <parser message>` | `1` |
| Stackfile validation errors | — | `Stackfile validation failed:\n  [CODE] message` (one per line) | `1` |
| Same-depth technology conflict at analysis time | — | `Classification conflict: technologies "<id1>" and "<id2>" both match "<file>" at the same depth` | `1` |

### Environment

The command reads from the filesystem only. No network access. No environment variable dependencies.

---

## 3. `stacklens --help`

Prints the top-level help text generated by Commander:

```
Usage: stacklens [command] [options]

Semantic technology stack projection toolkit

Options:
  -V, --version   output the version number
  -h, --help      display help for command

Commands:
  status          Validate the Stackfile and report uncovered files
```

Exit code: `0`

---

## 4. `stacklens status --help`

Prints the status-subcommand help text:

```
Usage: stacklens status [options]

Validate the Stackfile and report uncovered files

Options:
  -h, --help  display help for command
```

Exit code: `0`

---

## 5. `stacklens <unknown>`

```
stacklens unknowncmd
```

Commander outputs:

```
error: unknown command 'unknowncmd'. See 'stacklens --help'.
```

Exit code: `1`

---

## 6. Extension Contract (FR-012)

Each command module MUST export:

```typescript
import type { Command } from 'commander';

export function register(program: Command): void;
```

`main.ts` MUST call `register(program)` exactly once per command module after importing it. No other wiring is required from the entry point.

Future commands add one file and one import+call — no modifications to existing modules.
